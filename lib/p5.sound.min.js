/*! p5.sound.min.js v0.122 2014-08-18 */

var sndcore;sndcore=function(){"use strict";window.AudioContext=window.AudioContext||window.webkitAudioContext;var t=new window.AudioContext;p5.prototype.getAudioContext=function(){return t},"function"!=typeof t.createGain&&(window.audioContext.createGain=window.audioContext.createGainNode),"function"!=typeof t.createDelay&&(window.audioContext.createDelay=window.audioContext.createDelayNode),"function"!=typeof window.AudioBufferSourceNode.prototype.start&&(window.AudioBufferSourceNode.prototype.start=window.AudioBufferSourceNode.prototype.noteGrainOn),"function"!=typeof window.AudioBufferSourceNode.prototype.stop&&(window.AudioBufferSourceNode.prototype.stop=window.AudioBufferSourceNode.prototype.noteOff),"function"!=typeof window.OscillatorNode.prototype.start&&(window.OscillatorNode.prototype.start=window.OscillatorNode.prototype.noteOn),"function"!=typeof window.OscillatorNode.prototype.stop&&(window.OscillatorNode.prototype.stop=window.OscillatorNode.prototype.noteOff),window.AudioContext.prototype.hasOwnProperty("createScriptProcessor")||(window.AudioContext.prototype.createScriptProcessor=window.AudioContext.prototype.createJavaScriptNode),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var e=document.createElement("audio");p5.prototype.isSupported=function(){return!!e.canPlayType};var i=function(){return!!e.canPlayType&&e.canPlayType('audio/ogg; codecs="vorbis"')},o=function(){return!!e.canPlayType&&e.canPlayType("audio/mpeg;")},n=function(){return!!e.canPlayType&&e.canPlayType('audio/wav; codecs="1"')},s=function(){return!!e.canPlayType&&(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/aac;"))},r=function(){return!!e.canPlayType&&e.canPlayType("audio/x-aiff;")};p5.prototype.isFileSupported=function(t){switch(t.toLowerCase()){case"mp3":return o();case"wav":return n();case"ogg":return i();case"mp4":return s();case"aiff":return r();default:return!1}};var a=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1;a&&window.addEventListener("touchstart",function(){var e=t.createBuffer(1,1,22050),i=t.createBufferSource();i.buffer=e,i.connect(t.destination),i.start(0)},!1)}();var master;master=function(){"use strict";var t=function(){var t=p5.prototype.getAudioContext();this.input=t.createGain(),this.output=t.createGain(),this.limiter=t.createDynamicsCompressor(),this.limiter.threshold.value=0,this.limiter.ratio.value=100,this.audiocontext=t,this.output.disconnect(this.audiocontext.destination),this.inputSources=[],this.input.connect(this.limiter),this.limiter.connect(this.output),this.meter=t.createGain(),this.output.connect(this.meter),this.output.connect(this.audiocontext.destination),this.soundArray=[],this.extensions=[]},e=new t;return p5.soundOut=e,p5.soundOut._silentNode=e.audiocontext.createGain(),p5.soundOut._silentNode.gain.value=0,p5.soundOut._silentNode.connect(e.audiocontext.destination),e}(sndcore);var helpers;helpers=function(){"use strict";var t=master;p5.prototype.masterVolume=function(e){t.output.gain.value=e},p5.prototype.sampleRate=function(){return t.audiocontext.sampleRate},p5.prototype.getMasterVolume=function(){return t.output.gain.value},p5.prototype.freqToMidi=function(t){var e=Math.log(t/440)/Math.log(2),i=Math.round(12*e)+57;return i},p5.prototype.midiToFreq=function(t){return 440*Math.pow(2,(t-69)/12)},p5.prototype.soundFormats=function(){t.extensions=[];for(var e=0;e<arguments.length;e++){if(arguments[e]=arguments[e].toLowerCase(),!(["mp3","wav","ogg","m4a","aac"].indexOf(arguments[e])>-1))throw arguments[e]+" is not a valid sound format!";t.extensions.push(arguments[e])}},p5.prototype.registerMethod("remove",p5.prototype.disposeSound),p5.prototype.disposeSound=function(){for(var e=0;e<t.soundArray.length;e++)t.soundArray[e].dispose()},p5.prototype._checkFileFormats=function(e){var i;if("string"==typeof e){i=e;var o=i.split(".").pop();if(["mp3","wav","ogg","m4a","aac"].indexOf(o)>-1){var n=p5.prototype.isFileSupported(o);if(n)i=i;else for(var s=i.split("."),r=s[s.length-1],a=0;a<t.extensions.length;a++){var u=t.extensions[a],n=p5.prototype.isFileSupported(u);if(n){r="",2===s.length&&(r+=s[0]);for(var a=1;a<=s.length-2;a++){var c=s[a];r+="."+c}i=r+=".",i=i+=u;break}}}else for(var a=0;a<t.extensions.length;a++){var u=t.extensions[a],n=p5.prototype.isFileSupported(u);if(n){i=i+"."+u;break}}}else if("object"==typeof e)for(var a=0;a<e.length;a++){var u=e[a].split(".").pop(),n=p5.prototype.isFileSupported(u);if(n){i=e[a];break}}return i}}(master);var soundfile;soundfile=function(){"use strict";var t=master;p5.SoundFile=function(e,i){var o=p5.prototype._checkFileFormats(e);this.url=o,this.sources=[],this.source=null,this.buffer=null,this.playbackRate=1,this.gain=1,this.input=t.audiocontext.createGain(),this.output=t.audiocontext.createGain(),this.reversed=!1,this.startTime=0,this.endTime=null,this.playing=!1,this.paused=null,this.mode="sustain",this.startMillis=null,this.amplitude=new p5.Amplitude,this.output.connect(this.amplitude.input),this.panPosition=0,this.panner=t.audiocontext.createPanner(),this.panner.panningModel="equalpower",this.panner.distanceModel="linear",this.panner.setPosition(0,0,0),this.output.connect(this.panner),this.panner.connect(t.input),this.url&&this.load(i),t.soundArray.push(this)},p5.prototype.registerPreloadMethod("loadSound"),p5.prototype.loadSound=function(t,e){window.location.origin.indexOf("file://")>-1&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");var i=new p5.SoundFile(t,e);return i},p5.SoundFile.prototype.load=function(t){var e=new XMLHttpRequest;e.open("GET",this.url,!0),e.responseType="arraybuffer";var i=this;e.onload=function(){var o=p5.prototype.getAudioContext();o.decodeAudioData(e.response,function(e){i.buffer=e,t&&t(i)})},e.send()},p5.SoundFile.prototype.isLoaded=function(){return this.buffer?!0:!1},p5.SoundFile.prototype.play=function(e,i,o,n){var s=t.audiocontext.currentTime;if(!this.buffer)throw"not ready to play file, buffer has yet to load. Try preload()";if("restart"===this.mode&&this.buffer&&this.source){var s=t.audiocontext.currentTime;this.source.stop(s)}if(o){if(!(o>=0&&o<this.buffer.duration))throw"start time out of range";this.startTime=o}if(n){if(!(n>=0&&n<=this.buffer.duration))throw"end time out of range";this.endTime=n}else this.endTime=this.buffer.duration;if(this.source=t.audiocontext.createBufferSource(),this.source.buffer=this.buffer,this.source.loop=this.looping,this.source.loop===!0&&(this.source.loopStart=this.startTime,this.source.loopEnd=this.endTime),this.source.onended=function(){},this.source.gain)this.source.gain.value=i||1,this.source.connect(this.output);else{this.source.gain=t.audiocontext.createGain(),this.source.connect(this.source.gain);var r=i||1;this.source.gain.gain.setValueAtTime(r,t.audiocontext.currentTime),this.source.gain.connect(this.output)}this.source.playbackRate.cancelScheduledValues(s),e=e||Math.abs(this.playbackRate),this.source.playbackRate.setValueAtTime(e,s),this.paused&&(this.wasUnpaused=!0),this.paused&&this.wasUnpaused?this.source.start(0,this.pauseTime,this.endTime):(this.wasUnpaused=!1,this.pauseTime=0,this.source.start(0,this.startTime,this.endTime)),this.startSeconds=s,this.playing=!0,this.paused=!1,this.sources.push(this.source)},p5.SoundFile.prototype.playMode=function(e){var i=e.toLowerCase();if("restart"===i&&this.buffer&&this.source)for(var o=0;o<this.sources.length-1;o++){var n=t.audiocontext.currentTime;this.sources[o].stop(n)}if("restart"!==i&&"sustain"!==i)throw'Invalid play mode. Must be either "restart" or "sustain"';this.mode=i},p5.SoundFile.prototype.pause=function(){this.looping;if(this.isPlaying()&&this.buffer&&this.source){this.pauseTime=this.currentTime();var e=t.audiocontext.currentTime;this.source.stop(e),this.paused=!0,this.wasUnpaused=!1,this.playing=!1}},p5.SoundFile.prototype.loop=function(t,e,i,o){this.looping=!0,this.play(t,e,i,o)},p5.SoundFile.prototype.setLoop=function(t){if(t===!0)this.looping=!0;else{if(t!==!1)throw"Error: setLoop accepts either true or false";this.looping=!1}this.source&&(this.source.loop=this.looping)},p5.SoundFile.prototype.isLooping=function(){return this.source&&this.looping===!0&&this.isPlaying()===!0?!0:!1},p5.SoundFile.prototype.isPlaying=function(){return null!==this.playing?this.playing:(console.log("null"),!1)},p5.SoundFile.prototype.isPaused=function(){return this.paused?this.paused:!1},p5.SoundFile.prototype.stop=function(){if("sustain"==this.mode)this.stopAll(),this.playing=!1,this.pauseTime=0,this.wasUnpaused=!1,this.paused=!1;else if(this.buffer&&this.source){var e=t.audiocontext.currentTime;this.source.stop(e),this.playing=!1,this.pauseTime=0,this.wasUnpaused=!1,this.paused=!1}},p5.SoundFile.prototype.stopAll=function(){if(this.buffer&&this.source)for(var e=0;e<this.sources.length;e++)if(null!==this.sources[e]){var i=t.audiocontext.currentTime;this.sources[e].stop(i)}},p5.SoundFile.prototype.setVolume=function(e,i,o){var i=i||0,o=o||0;console.log("rampTime: "+i+", + tFromNow: "+o);var n=this.output.gain.value;this.output.gain.cancelScheduledValues(t.audiocontext.currentTime),this.output.gain.setValueAtTime(n,t.audiocontext.currentTime+o),this.output.gain.cancelScheduledValues(t.audiocontext.currentTime),this.output.gain.linearRampToValueAtTime(e,t.audiocontext.currentTime+.01+o+i)},p5.SoundFile.prototype.amp=p5.SoundFile.prototype.setVolume,p5.SoundFile.prototype.fade=p5.SoundFile.prototype.setVolume,p5.SoundFile.prototype.getVolume=function(){return this.output.gain.value},p5.SoundFile.prototype.pan=function(t){this.panPosition=t,t=90*t;var e=parseInt(t),i=e+90;i>90&&(i=180-i);var o=Math.sin(e*(Math.PI/180)),n=Math.sin(i*(Math.PI/180));this.panner.setPosition(o,0,n)},p5.SoundFile.prototype.getPan=function(){return this.panPosition},p5.SoundFile.prototype.rate=function(e){if(this.playbackRate!==e||!this.source||this.source.playbackRate.value!==e){this.playbackRate=e;var i=e;if(0===this.playbackRate&&this.playing&&this.pause(),this.playbackRate<0&&!this.reversed){{var o=this.currentTime();this.source.playbackRate.value}this.pause(),this.reverseBuffer(),i=Math.abs(e);var n=(o-this.duration())/i;this.pauseTime=n,this.play()}else this.playbackRate>0&&this.reversed&&this.reverseBuffer();if(this.source){var s=t.audiocontext.currentTime;this.source.playbackRate.cancelScheduledValues(s),this.source.playbackRate.linearRampToValueAtTime(Math.abs(i),s)}}},p5.SoundFile.prototype.getPlaybackRate=function(){return this.playbackRate},p5.SoundFile.prototype.duration=function(){return this.buffer?this.buffer.duration:0},p5.SoundFile.prototype.currentTime=function(){var e;if(this.isPlaying()){var i=t.audiocontext.currentTime-this.startSeconds+this.startTime+this.pauseTime;return e=i*this.playbackRate%(this.duration()*this.playbackRate)}return this.paused?this.pauseTime:this.startTime},p5.SoundFile.prototype.jump=function(e,i){if(0>e||e>this.buffer.duration)throw"jump time out of range";if(e>i||i>this.buffer.duration)throw"end time out of range";if(this.startTime=e||0,this.endTime=i?i:this.buffer.duration,this.isPlaying()){var o=t.audiocontext.currentTime;this.stop(o),this.play(e,this.endTime)}},p5.SoundFile.prototype.channels=function(){return this.buffer.numberOfChannels},p5.SoundFile.prototype.sampleRate=function(){return this.buffer.sampleRate},p5.SoundFile.prototype.frames=function(){return this.buffer.length},p5.SoundFile.prototype.getPeaks=function(t){if(!this.buffer)throw"Cannot load peaks yet, buffer is not loaded";if(t||(t=5*window.width),this.buffer){for(var e=this.buffer,i=e.length/t,o=~~(i/10)||1,n=e.numberOfChannels,s=new Float32Array(t),r=0;n>r;r++)for(var a=e.getChannelData(r),u=0;t>u;u++){for(var c=~~(u*i),p=~~(c+i),l=0,h=c;p>h;h+=o){var d=a[h];d>l?l=d:-d>l&&(l=d)}(0===r||l>s[u])&&(s[u]=l)}return s}},p5.SoundFile.prototype.reverseBuffer=function(){if(!this.buffer)throw"SoundFile is not done loading";Array.prototype.reverse.call(this.buffer.getChannelData(0)),Array.prototype.reverse.call(this.buffer.getChannelData(1)),this.reversed=!this.reversed},p5.SoundFile.prototype._onEnded=function(e){e.onended=function(e){var i=t.audiocontext.currentTime;e.stop(i)}},p5.SoundFile.prototype.add=function(){},p5.SoundFile.prototype.dispose=function(){if(this.buffer&&this.source)for(var e=0;e<this.sources.length-1;e++)if(null!==this.sources[e]){var i=t.audiocontext.currentTime;this.sources[e].stop(i),this.sources[e]=null}"undefined"!=typeof this.output&&(this.output.disconnect(),this.output=null),"undefined"!=typeof this.panner&&(this.panner.disconnect(),this.panner=null)},p5.SoundFile.prototype.connect=function(e){this.panner.connect(e?e.hasOwnProperty("input")?e.input:e:t.input)},p5.SoundFile.prototype.disconnect=function(t){this.panner.disconnect(t)},p5.SoundFile.prototype.getLevel=function(t){return t&&(this.amplitude.smoothing=t),this.amplitude.getLevel()},p5.SoundFile.prototype.setPath=function(t,e){var i=p5.prototype._checkFileFormats(t);this.url=i,this.load(e)},p5.SoundFile.prototype.setBuffer=function(e){var i=t.audiocontext;console.log("setting buffer!"),console.log(e);for(var o=i.createBuffer(2,e[0].length,i.sampleRate),n=0;n<e.length;n++){var s=o.getChannelData(n);s.set(e[n])}this.buffer=o}}(sndcore,master);var amplitude;amplitude=function(){"use strict";var t=master;p5.Amplitude=function(e){this.bufferSize=2048,this.audiocontext=t.audiocontext,this.processor=this.audiocontext.createScriptProcessor(this.bufferSize),this.input=this.processor,this.output=this.audiocontext.createGain(),this.smoothing=e||0,this.volume=0,this.average=0,this.volMax=.001,this.normalize=!1,this.processor.onaudioprocess=this.volumeAudioProcess.bind(this),this.processor.connect(this.output),this.output.gain.value=0,this.output.connect(this.audiocontext.destination),t.meter.connect(this.processor)},p5.Amplitude.prototype.setInput=function(e,i){t.meter.disconnect(this.processor),i&&(this.smoothing=i),null==e?(console.log("Amplitude input source is not ready! Connecting to master output instead"),t.meter.connect(this.processor)):e instanceof p5.Signal?(console.log("signal!"),e.output.connect(this.processor)):e?(console.log("source!"),e.connect(this.processor),this.processor.disconnect(),this.processor.connect(this.output),console.log("source connected")):t.meter.connect(this.processor)},p5.Amplitude.prototype.connect=function(e){this.output.connect(e?e.hasOwnProperty("input")?e.input:e:this.panner.connect(t.input))},p5.Amplitude.prototype.disconnect=function(){this.output.disconnect()},p5.Amplitude.prototype.volumeAudioProcess=function(t){for(var e,i=t.inputBuffer.getChannelData(0),o=i.length,n=0,s=0,r=0;o>r;r++)e=i[r],this.normalize?(n+=p5.prototype.constrain(e/this.volMax,-1,1),s+=p5.prototype.constrain(e/this.volMax,-1,1)*p5.prototype.constrain(e/this.volMax,-1,1)):(n+=e,s+=e*e);var a=Math.sqrt(s/o);this.volume=Math.max(a,this.volume*this.smoothing),this.volMax=Math.max(this.volume,this.volMax),this.volNorm=p5.prototype.constrain(this.volume/this.volMax,0,1)},p5.Amplitude.prototype.getLevel=function(){return this.normalize?this.volNorm:this.volume},p5.Amplitude.prototype.toggleNormalize=function(t){this.normalize="boolean"==typeof t?t:!this.normalize},p5.Amplitude.prototype.smooth=function(t){t>=0&&1>t?this.smoothing=t:console.log("Error: smoothing must be between 0 and 1")}}(master);var fft;fft=function(){"use strict";var t=master;p5.FFT=function(e,i){var o=e||.8;0===e&&(o=e);var n=2*i||2048;this.analyser=t.audiocontext.createAnalyser(),t.output.connect(this.analyser),this.analyser.smoothingTimeConstant=o,this.analyser.fftSize=n,this.freqDomain=new Uint8Array(this.analyser.frequencyBinCount),this.timeDomain=new Uint8Array(this.analyser.frequencyBinCount),this.bass=[20,140],this.lowMid=[140,400],this.mid=[400,2600],this.highMid=[2600,5200],this.treble=[5200,14e3]},p5.FFT.prototype.setInput=function(t,e){e&&(this.analyser.fftSize=2*e),t.output?t.output.connect(this.analyser):t.connect(this.analyser)},p5.FFT.prototype.waveform=function(t){t&&(this.analyser.fftSize=2*t),this.analyser.getByteTimeDomainData(this.timeDomain);var e=Array.apply([],this.timeDomain);return e.length===this.analyser.fftSize,e.constructor===Array,e},p5.FFT.prototype.analyze=function(t){t&&(this.analyser.fftSize=2*t),this.analyser.getByteFrequencyData(this.freqDomain);var e=Array.apply([],this.freqDomain);return e.length===this.analyser.fftSize,e.constructor===Array,e},p5.FFT.prototype.getEnergy=function(e,i){var o=t.audiocontext.sampleRate/2;if("bass"===e?(e=this.bass[0],i=this.bass[1]):"lowMid"===e?(e=this.lowMid[0],i=this.lowMid[1]):"mid"===e?(e=this.mid[0],i=this.mid[1]):"highMid"===e?(e=this.highMid[0],i=this.highMid[1]):"treble"===e&&(e=this.treble[0],i=this.treble[1]),"number"!=typeof e)throw"invalid input for getEnergy()";if(i){if(e&&i){if(e>i){var n=i;i=e,e=n}for(var s=Math.round(e/o*this.freqDomain.length),r=Math.round(i/o*this.freqDomain.length),a=0,u=0,c=s;r>=c;c++)a+=this.freqDomain[c],u+=1;var p=a/u;return p}throw"invalid input for getEnergy()"}var l=Math.round(e/o*this.freqDomain.length);return this.freqDomain[l]},p5.FFT.prototype.getFreq=function(t,e){console.log("getFreq() is deprecated. Please use getEnergy() instead.");var i=this.getEnergy(t,e);return i},p5.FFT.prototype.smooth=function(t){this.analyser.smoothingTimeConstant=t}}(master);var signal;signal=function(){"use strict";var t=master,e=t.audiocontext,i=e.createOscillator(),o=e.createWaveShaper();!function(){for(var t=8,e=new Float32Array(t),i=0;t>i;i++)e[i]=1;o.curve=e}(),i.connect(o),i.start(0),i.connect(p5.soundOut._silentNode),p5.Signal=function(t){this.scalar=e.createGain(),this.scalar.gain.maxValue=1e4,this.scalar.gain.minValue=-1e4,this.input=e.createGain(),this.input.gain.maxValue=1e4,this.input.gain.minValue=-1e4,this.output=e.createGain(),this.output.gain.maxValue=1e4,this.output.gain.minValue=-1e4,this._syncRatio=1,o.connect(this.scalar),this.scalar.connect(this.output),this.input.connect(this.output);var t=t||0;this.setValue(t)},p5.Signal.prototype.getValue=function(){return this.scalar.gain.value},p5.Signal.prototype.setValue=function(t){"number"==typeof t?(0===this._syncRatio?t=0:t*=this._syncRatio,this.scalar.gain.setValueAtTime(t,e.currentTime)):t.connect(this._syncRatio)},p5.Signal.prototype.setValueAtTime=function(t,e){t*=this._syncRatio;var i=e||0;this.scalar.gain.setValueAtTime(t,i)},p5.Signal.prototype.setCurrentValueNow=function(){var t=e.currentTime,i=this.getValue();return this.cancelScheduledValues(t),this.scalar.gain.linearRampToValueAtTime(i,t),i},p5.Signal.prototype.cancelScheduledValues=function(t){var e=t||0;this.scalar.gain.cancelScheduledValues(e)},p5.Signal.prototype.linearRampToValueAtTime=function(t,e){var i=e||0;t*=this._syncRatio,this.scalar.gain.linearRampToValueAtTime(t,i)},p5.Signal.prototype.exponentialRampToValueAtTime=function(t,e){var i=e||0;t*=this._syncRatio,this.scalar.gain.exponentialRampToValueAtTime(t,i)},p5.Signal.prototype.fade=function(t,i){var o=i||0,n=e.currentTime+o+.01;t*=this._syncRatio,this.scalar.gain.linearRampToValueAtTime(t,n)},p5.Signal.prototype.dispose=function(){this.output.disconnect(),this.scalar.disconnect(),this.output=null,this.scalar=null},p5.Signal.prototype.setInput=function(t){t.connect(this.input)},p5.Signal.prototype.connect=function(t){t instanceof p5.Signal?t.setValue(0):t instanceof AudioParam&&(t.setValueAtTime(0,e.currentTime),console.log("setting to zero")),this.output.connect(t)},p5.Signal.prototype.disconnect=function(){this.output.disconnect(node)},p5.Signal.prototype.add=function(t){var e=new p5.SignalAdd(t);return e.setInput(this),e},p5.Signal.prototype.mult=function(t){var e=new p5.SignalMult(t);return e.setInput(this),e},p5.Signal.prototype.scale=function(t,e,i,o){var n=new p5.SignalScale(t,e,i,o);return n.setInput(this),n},p5.SignalAdd=function(t){var e=new p5.Signal(t);return e},p5.SignalMult=function(t,e){var i=new p5.Signal;return i.output=i.input,i.input.gain.maxValue=1e4,i.input.gain.minValue=-1e4,i.setValue=function(t){"number"==typeof t?this.input.gain.value=t:t.connect(this.input.gain)},t&&i.setValue(t),e&&i.setInput(e),i},p5.SignalScale=function(t,e,i,o){var n=new p5.Signal;return n.scalar.disconnect(),n.input.disconnect(),2==arguments.length&&(i=t,o=e,t=-1,e=1),n._plusInput=new p5.SignalAdd(-t),n._scale=new p5.SignalMult((o-i)/(e-t)),n._plusOutput=new p5.SignalAdd(i),n._plusInput.setInput(n.input),n._scale.setInput(n._plusInput.output),n._plusOutput.setInput(n._scale.output),n._plusOutput.connect(n.output),n}}(master);var oscillator;oscillator=function(){"use strict";var t=master;p5.Oscillator=function(e,i){if("string"==typeof e){var o=i;i=e,e=o}if("number"==typeof i){var o=i;i=e,e=o}this.started=!1,t=t,this.oscillator=t.audiocontext.createOscillator(),this.f=e||440,this.oscillator.frequency.setValueAtTime(this.f,t.audiocontext.currentTime),this.oscillator.type=i||"sine";this.oscillator;this.input=t.audiocontext.createGain(),this.output=t.audiocontext.createGain(),this.ampNode=this.oscillator.gain,this.freqNode=this.oscillator.frequency,this._freqMods=[],this.output.gain.value=0,this.output.gain.setValueAtTime(0,t.audiocontext.currentTime),this.panPosition=0,this.panner=t.audiocontext.createPanner(),this.panner.panningModel="equalpower",this.panner.distanceModel="linear",this.panner.setPosition(0,0,0),this.oscillator.connect(this.output),this.output.connect(this.panner),this.panner.connect(t.input),this.connection=t.input,t.soundArray.push(this)},p5.Oscillator.prototype.start=function(e,i){if(this.started){var o=t.audiocontext.currentTime;this.stop(o)}if(!this.started){var n=i||this.f,s=this.oscillator.type;this.oscillator=t.audiocontext.createOscillator(),this.oscillator.frequency.exponentialRampToValueAtTime(Math.abs(n),t.audiocontext.currentTime),this.oscillator.type=s,this.oscillator.connect(this.output),e=e||0,this.oscillator.start(e+t.audiocontext.currentTime),this.freqNode=this.oscillator.frequency;for(var r in this._freqMods)this._freqMods[r].connect(this.oscillator.frequency);this.started=!0}},p5.Oscillator.prototype.stop=function(e){if(this.started){var i=e||0,o=t.audiocontext.currentTime;this.oscillator.stop(i+o),this.started=!1}},p5.Oscillator.prototype.amp=function(e,i,o){if("number"==typeof e){var i=i||0,o=o||0,n=t.audiocontext.currentTime,s=this.output.gain.value;this.output.gain.cancelScheduledValues(n),this.output.gain.linearRampToValueAtTime(s,n+o),this.output.gain.linearRampToValueAtTime(e,n+o+i)}else{if(!e.output)return this.output.gain;e.output.connect(this.output.gain)}},p5.Oscillator.prototype.fade=p5.Oscillator.prototype.amp,p5.Oscillator.prototype.getAmp=function(){return this.output.gain.value},p5.Oscillator.prototype.freq=function(e,i,o){if("number"==typeof e){this.f=e;var n=t.audiocontext.currentTime,i=i||0,o=o||0,s=this.oscillator.frequency.value;this.oscillator.frequency.cancelScheduledValues(n),this.oscillator.frequency.setValueAtTime(s,n+o),e>0?this.oscillator.frequency.exponentialRampToValueAtTime(e,o+i+n):this.oscillator.frequency.linearRampToValueAtTime(e,o+i+n)}else e.connect(this.oscillator.frequency),this._freqMods.push(e)},p5.Oscillator.prototype.getFreq=function(){return this.oscillator.frequency.value},p5.Oscillator.prototype.setType=function(t){this.oscillator.type=t},p5.Oscillator.prototype.getType=function(){return this.oscillator.type},p5.Oscillator.prototype.connect=function(e){e?e.hasOwnProperty("input")?(this.panner.connect(e.input),this.connection=e.input):(this.panner.connect(e),this.connection=e):this.panner.connect(t.input)},p5.Oscillator.prototype.disconnect=function(t){this.panner.disconnect(t),this.oscMods=[]},p5.Oscillator.prototype.pan=function(t){t||(t=0),this.panPosition=t,t=90*t;var e=parseInt(t),i=e+90;i>90&&(i=180-i);var o=Math.sin(e*(Math.PI/180)),n=Math.sin(i*(Math.PI/180));this.panner.setPosition(o,0,n)},p5.Oscillator.prototype.getPan=function(){return this.panPosition},p5.Oscillator.prototype.dispose=function(){if(this.oscillator){var e=t.audiocontext.currentTime;this.stop(e),this.disconnect(),this.oscillator.disconnect(),this.panner=null,this.oscillator=null}this.osc2&&this.osc2.dispose()},p5.Oscillator.prototype.phase=function(e){this.dNode||(this.dNode=t.audiocontext.createDelay(),this.output.disconnect(),this.output.connect(this.dNode),this.dNode.connect(this.panner));var i=t.audiocontext.currentTime;this.dNode.delayTime.linearRampToValueAtTime(map(e,0,1,0,1/this.oscillator.frequency.value),i)},p5.Oscillator.prototype.add=function(t){var e=new p5.SignalAdd(t);return e.setInput(this),e},p5.Oscillator.prototype.mult=function(t){var e=new p5.SignalMult(t);return e.setInput(this),e},p5.Oscillator.prototype.scale=function(t,e,i,o){var n=new p5.SignalScale(t,e,i,o);return n.setInput(this),n},p5.SinOsc=function(t){p5.Oscillator.call(this,t,"sine")},p5.SinOsc.prototype=Object.create(p5.Oscillator.prototype),p5.TriOsc=function(t){p5.Oscillator.call(this,t,"triangle")},p5.TriOsc.prototype=Object.create(p5.Oscillator.prototype),p5.SawOsc=function(t){p5.Oscillator.call(this,t,"sawtooth")},p5.SawOsc.prototype=Object.create(p5.Oscillator.prototype),p5.SqrOsc=function(t){p5.Oscillator.call(this,t,"square")},p5.SqrOsc.prototype=Object.create(p5.Oscillator.prototype)}(master);var env;env=function(){"use strict";var t=master;p5.Env=function(e,i,o,n,s,r,a,u){this.aTime=e,this.aLevel=i,this.dTime=o||0,this.dLevel=n||0,this.sTime=s||0,this.sLevel=r||0,this.rTime=a||0,this.rLevel=u||0,this.output=t.audiocontext.createGain(),this.control=new p5.Signal,this.control.connect(this.output),this.timeoutID=null,this.connection=null},p5.Env.prototype.set=function(t,e,i,o,n,s,r,a){this.aTime=t,this.aLevel=e,this.dTime=i||0,this.dLevel=o||0,this.sTime=n||0,this.sLevel=s||0,this.rTime=r||0,this.rLevel=a||0},p5.Env.prototype.setInput=function(t){this.connect(t)},p5.Env.prototype.ctrl=function(t){this.connect(t)},p5.Env.prototype.play=function(e,i){function o(){this.connection&&this.connection.hasOwnProperty("oscillator")&&e.started&&(this.connection.amp(0),this.connection.stop())}var n=t.audiocontext.currentTime,s=i||0,r=n+s+.001;"number"==typeof this.timeoutID&&window.clearTimeout(this.timeoutID);this.control.getValue();if(this.control.cancelScheduledValues(r),this.control.fade(0,r),e&&this.connection!==e&&this.connect(e),this.connection instanceof p5.Oscillator&&(this.connection.stop(),this.connection.amp(0)),this.control.linearRampToValueAtTime(this.aLevel,r+this.aTime),this.control.linearRampToValueAtTime(this.dLevel,r+this.aTime+this.dTime),this.control.linearRampToValueAtTime(this.sLevel,r+this.aTime+this.dTime+this.sTime),this.control.linearRampToValueAtTime(this.rLevel,r+this.aTime+this.dTime+this.sTime+this.rTime),this.connection&&this.connection.hasOwnProperty("oscillator")){var a=1e3*(r+this.aTime+this.dTime+this.sTime+this.rTime);this.timeoutID=window.setTimeout(o,a),this.connection.start()}},p5.Env.prototype.triggerAttack=function(e,i){var o=t.audiocontext.currentTime,n=i||0,s=o+n;this.lastAttack=s,"number"==typeof this.timeoutID&&window.clearTimeout(this.timeoutID);var r=this.control.getValue();this.control.cancelScheduledValues(s),this.control.fade(r),e&&this.connection!==e&&this.connect(e),this.connection&&this.connection instanceof p5.Oscillator&&this.connection.started&&this.connection.stop(),this.control.linearRampToValueAtTime(this.aLevel,s+this.aTime),this.control.linearRampToValueAtTime(this.aLevel,s+this.aTime),this.control.linearRampToValueAtTime(this.dLevel,s+this.aTime+this.dTime),this.control.linearRampToValueAtTime(this.sLevel,s+this.aTime+this.dTime+this.sTime),this.connection&&this.connection instanceof p5.Oscillator&&(this.connection.started||this.connection.start())},p5.Env.prototype.triggerRelease=function(e,i){function o(){this.connection.hasOwnProperty("oscillator")&&e.started&&(this.connection.amp(0),this.connection.stop())}var n,s=t.audiocontext.currentTime+.001,r=i||0,a=s+r;e&&this.connection!==e&&this.connect(e);var u=this.control.getValue();if(this.control.cancelScheduledValues(a),this.control.fade(u),s-this.lastAttack>this.aTime+this.dTime+this.sTime+this.rTime?(this.control.linearRampToValueAtTime(this.sLevel,a+this.sTime),this.control.linearRampToValueAtTime(this.rLevel,a+this.sTime+this.rTime),n=a+this.rTime):s-this.lastAttack>this.aTime+this.dTime?(this.control.linearRampToValueAtTime(this.dLevel,a+this.dTime),this.control.linearRampToValueAtTime(this.sLevel,a+this.dTime+this.sTime),this.control.linearRampToValueAtTime(this.rLevel,a+this.dTime+this.sTime+this.rTime),n=a+this.sTime+this.rTime):s-this.lastAttack>this.aTime&&(this.control.linearRampToValueAtTime(this.dLevel,a+this.dTime),this.control.linearRampToValueAtTime(this.sLevel,a+this.dTime+this.sTime),this.control.linearRampToValueAtTime(this.rLevel,a+this.dTime+this.sTime+this.rTime),n=a+this.dTime+this.sTime+this.rTime),this.connection.hasOwnProperty("oscillator")){var c=1e3*n;this.timeoutID=window.setTimeout(o,c)}},p5.Env.prototype.connect=function(e){this.disconnect(),this.connection=e,(e instanceof p5.Oscillator||e instanceof p5.SoundFile||e instanceof p5.AudioIn||e instanceof p5.Reverb||e instanceof p5.Noise||e instanceof p5.Filter||e instanceof p5.Delay)&&(e=e.output.gain),e instanceof AudioParam&&e.setValueAtTime(0,t.audiocontext.currentTime),e instanceof p5.Signal&&e.setValue(0),this.output.connect(e)},p5.Env.prototype.disconnect=function(){this.output.disconnect()},p5.Env.prototype.add=function(t){var e=new p5.SignalAdd(t);return e.setInput(this.control),e},p5.Env.prototype.mult=function(t){var e=new p5.SignalMult(t);return e.setInput(this.control),e},p5.Env.prototype.scale=function(t,e,i,o){var n=new p5.SignalScale(t,e,i,o);return n.setInput(this.control),n}}(master);var pulse;pulse=function(){"use strict";var t=master;p5.Pulse=function(e,i){p5.Oscillator.call(this,e,"sawtooth"),this.w=i||0,this.osc2=new p5.SawOsc(e),this.dNode=t.audiocontext.createDelay(),this.dNode.delayTime.value=map(this.w,0,1,0,1/this.oscillator.frequency.value),this.osc2.disconnect(),this.osc2.panner.connect(this.dNode),this.dNode.connect(this.output)},p5.Pulse.prototype=Object.create(p5.Oscillator.prototype),p5.Pulse.prototype.width=function(t){1>=t&&t>=0&&(this.w=t,this.dNode.delayTime.value=map(this.w,0,1,0,1/this.oscillator.frequency.value))},p5.Pulse.prototype.start=function(e,i){var o=t.audiocontext.currentTime,n=i||0;if(!this.started){var s=e||this.f,r=this.oscillator.type;this.oscillator=t.audiocontext.createOscillator(),this.oscillator.frequency.setValueAtTime(s,o),this.oscillator.type=r,this.oscillator.connect(this.output),this.oscillator.start(n+o),this.osc2.oscillator=t.audiocontext.createOscillator(),this.osc2.oscillator.frequency.setValueAtTime(s,o),this.osc2.oscillator.type=r,this.osc2.start(n+o),this.freqNode=[this.oscillator.frequency,this.osc2.oscillator.frequency],void 0!==this.mods&&void 0!==this.mods.frequency&&(this.mods.frequency.connect(this.freqNode[0]),this.mods.frequency.connect(this.freqNode[1])),this.started=!0,this.osc2.started=!0}},p5.Pulse.prototype.stop=function(e){if(this.started){var i=e||0,o=t.audiocontext.currentTime;this.oscillator.stop(i+o),this.osc2.oscillator.stop(i+o),this.started=!1,this.osc2.started=!1}},p5.Pulse.prototype.freq=function(e,i,o){if("number"==typeof e){this.f=e;var n=t.audiocontext.currentTime,i=i||0,o=o||0,s=this.oscillator.frequency.value;this.oscillator.frequency.cancelScheduledValues(n),this.oscillator.frequency.setValueAtTime(s,n+o),this.oscillator.frequency.exponentialRampToValueAtTime(e,o+i+n),this.osc2.oscillator.frequency.cancelScheduledValues(n),this.osc2.oscillator.frequency.setValueAtTime(s,n+o),this.osc2.oscillator.frequency.exponentialRampToValueAtTime(e,o+i+n),this.freqMod&&(this.freqMod.output.disconnect(),this.freqMod=null)}else e.output&&(e.output.disconnect(),e.output.connect(this.oscillator.frequency),e.output.connect(this.osc2.oscillator.frequency),this.freqMod=e)}}(master,oscillator);var noise;noise=function(){"use strict";var t=master;p5.Noise=function(){this.started=!1,this.buffer=e,this.output=t.audiocontext.createGain(),this.output.gain.value=.5,this.panPosition=0,this.panner=t.audiocontext.createPanner(),this.panner.panningModel="equalpower",this.panner.distanceModel="linear",this.panner.setPosition(0,0,0),this.output.connect(this.panner),this.panner.connect(t.input),t.soundArray.push(this)
};var e=function(){for(var e=2*t.audiocontext.sampleRate,i=t.audiocontext.createBuffer(1,e,t.audiocontext.sampleRate),o=i.getChannelData(0),n=0;e>n;n++)o[n]=2*Math.random()-1;return i}(),i=function(){var e,i,o,n,s,r,a,u=2*t.audiocontext.sampleRate,c=t.audiocontext.createBuffer(1,u,t.audiocontext.sampleRate),p=c.getChannelData(0);e=i=o=n=s=r=a=0;for(var l=0;u>l;l++){var h=2*Math.random()-1;e=.99886*e+.0555179*h,i=.99332*i+.0750759*h,o=.969*o+.153852*h,n=.8665*n+.3104856*h,s=.55*s+.5329522*h,r=-.7616*r-.016898*h,p[l]=e+i+o+n+s+r+a+.5362*h,p[l]*=.11,a=.115926*h}return c}(),o=function(){for(var e=2*t.audiocontext.sampleRate,i=t.audiocontext.createBuffer(1,e,t.audiocontext.sampleRate),o=i.getChannelData(0),n=0,s=0;e>s;s++){var r=2*Math.random()-1;o[s]=(n+.02*r)/1.02,n=o[s],o[s]*=3.5}return i}();p5.Noise.prototype.ampMod=function(e){e.output.gain.cancelScheduledValues(t.audiocontext.currentTime),this.output.connect(e.output.gain)},p5.Noise.prototype.setType=function(n){switch(n){case"white":this.buffer=e;break;case"pink":this.buffer=i;break;case"brown":this.buffer=o;break;default:this.buffer=e}if(this.started){var s=t.audiocontext.currentTime;this.stop(s),this.start(s+.01)}},p5.Noise.prototype.start=function(){this.started&&this.stop(),this.noise=t.audiocontext.createBufferSource(),this.noise.buffer=this.buffer,this.noise.loop=!0,this.noise.connect(this.output);var e=t.audiocontext.currentTime;this.noise.start(e),this.started=!0},p5.Noise.prototype.stop=function(){var e=t.audiocontext.currentTime;this.noise&&(this.noise.stop(e),this.started=!1)},p5.Noise.prototype.pan=function(t){this.panPosition=t,t=90*t;var e=parseInt(t),i=e+90;i>90&&(i=180-i);var o=Math.sin(e*(Math.PI/180)),n=Math.sin(i*(Math.PI/180));this.panner.setPosition(o,0,n)},p5.Noise.prototype.amp=function(e,i,o){var i=i||0,o=o||0,n=t.audiocontext.currentTime,s=this.output.gain.value;this.output.gain.cancelScheduledValues(n),this.output.gain.linearRampToValueAtTime(s,n+o+.001),this.output.gain.linearRampToValueAtTime(e,n+o+i+.001)},p5.Noise.prototype.connect=function(e){this.panner.connect(e?e.hasOwnProperty("input")?e.input:e:t.input)},p5.Noise.prototype.disconnect=function(){this.output.disconnect(),this.panner.disconnect(),this.output.connect(this.panner)},p5.Noise.prototype.dispose=function(){var e=t.audiocontext.currentTime;this.noise&&(this.noise.disconnect(),this.stop(e)),this.output&&this.output.disconnect(),this.panner&&this.panner.disconnect(),this.output=null,this.panner=null,this.buffer=null,this.noise=null}}(master);var audioin;audioin=function(){"use strict";var t=master;p5.AudioIn=function(){this.input=t.audiocontext.createGain(),this.output=t.audiocontext.createGain(),this.stream=null,this.mediaStream=null,this.currentSource=0,this.enabled=!1,this.amplitude=new p5.Amplitude,this.output.connect(this.amplitude.input),"undefined"==typeof window.MediaStreamTrack?window.alert("This browser does not support MediaStreamTrack"):"undefined"!=typeof window.MediaStreamTrack.getSources&&window.MediaStreamTrack.getSources(this._gotSources),t.soundArray.push(this)},p5.AudioIn.prototype.start=function(){var e=this;if(t.inputSources[e.currentSource]){var i=t.inputSources[e.currentSource].id,o={audio:{optional:[{sourceId:i}]}};navigator.getUserMedia(o,this._onStream=function(i){e.stream=i,e.enabled=!0,e.mediaStream=t.audiocontext.createMediaStreamSource(i),e.mediaStream.connect(e.output),e.amplitude.setInput(e.output)},this._onStreamError=function(t){console.error(t)})}else window.navigator.getUserMedia({audio:!0},this._onStream=function(i){e.stream=i,e.enabled=!0,e.mediaStream=t.audiocontext.createMediaStreamSource(i),e.mediaStream.connect(e.output),e.amplitude.setInput(e.output)},this._onStreamError=function(t){console.error(t)})},p5.AudioIn.prototype.stop=function(){this.stream&&this.stream.stop()},p5.AudioIn.prototype.connect=function(e){this.output.connect(e?e.hasOwnProperty("input")?e.input:e.hasOwnProperty("analyser")?e.analyser:e:t.input)},p5.AudioIn.prototype.disconnect=function(t){this.output.disconnect(t),this.output.connect(this.amplitude.input)},p5.AudioIn.prototype.getLevel=function(t){return t&&(this.amplitude.smoothing=t),this.amplitude.getLevel()},p5.AudioIn.prototype._gotSources=function(e){for(var i=0;i!==e.length;i++){var o=e[i];"audio"===o.kind&&t.inputSources.push(o)}},p5.AudioIn.prototype.amp=function(e,i){if(i){var o=i||0,n=this.output.gain.value;this.output.gain.cancelScheduledValues(t.audiocontext.currentTime),this.output.gain.setValueAtTime(n,t.audiocontext.currentTime),this.output.gain.linearRampToValueAtTime(e,o+t.audiocontext.currentTime)}else this.output.gain.cancelScheduledValues(t.audiocontext.currentTime),this.output.gain.setValueAtTime(e,t.audiocontext.currentTime)},p5.AudioIn.prototype.listSources=function(){return console.log("input sources: "),console.log(t.inputSources),t.inputSources.length>0?t.inputSources:"This browser does not support MediaStreamTrack.getSources()"},p5.AudioIn.prototype.setSource=function(e){var i=this;t.inputSources.length>0&&e<t.inputSources.length?(i.currentSource=e,console.log("set source to "+t.inputSources[i.currentSource].id)):console.log("unable to set input source")},p5.AudioIn.prototype.dispose=function(){this.stop(),this.output.disconnect(),this.amplitude.disconnect(),this.amplitude=null,this.output=null}}(master);var filter;filter=function(){"use strict";var t=master;p5.Filter=function(e){this.ac=t.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.biquad=this.ac.createBiquadFilter(),this.input.connect(this.biquad),this.biquad.connect(this.output),this.connect(),e&&this.setType(e)},p5.Filter.prototype.process=function(t,e,i){t.connect(this.input),this.set(e,i)},p5.Filter.prototype.set=function(t,e){t&&this.freq(t),e&&this.res(e)},p5.Filter.prototype.freq=function(t){var e=this;return"number"==typeof t?(e.biquad.frequency.value=t,e.biquad.frequency.cancelScheduledValues(this.ac.currentTime+.01),e.biquad.frequency.setValueAtTime(t,this.ac.currentTime+.02)):t&&t.connect(this.biquad.frequency),e.biquad.frequency.value},p5.Filter.prototype.res=function(t){var e=this;return"number"==typeof t?(e.biquad.Q.value=t,e.biquad.Q.cancelScheduledValues(e.ac.currentTime+.01),e.biquad.Q.setValueAtTime(t,e.ac.currentTime+.02)):t&&freq.connect(this.biquad.Q),e.biquad.Q.value},p5.Filter.prototype.setType=function(t){this.biquad.type=t},p5.Filter.prototype.amp=function(e,i,o){var i=i||0,o=o||0,n=t.audiocontext.currentTime,s=this.output.gain.value;this.output.gain.cancelScheduledValues(n),this.output.gain.linearRampToValueAtTime(s,n+o+.001),this.output.gain.linearRampToValueAtTime(e,n+o+i+.001)},p5.Filter.prototype.connect=function(t){var e=t||p5.soundOut.input;this.output.connect(e)},p5.Filter.prototype.disconnect=function(){this.output.disconnect()},p5.LowPass=function(){p5.Filter.call(this,"lowpass")},p5.LowPass.prototype=Object.create(p5.Filter.prototype),p5.HighPass=function(){p5.Filter.call(this,"highpass")},p5.HighPass.prototype=Object.create(p5.Filter.prototype),p5.BandPass=function(){p5.Filter.call(this,"bandpass")},p5.BandPass.prototype=Object.create(p5.Filter.prototype)}(master);var delay;delay=function(){"use strict";var t=master;p5.Delay=function(){this.ac=t.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this._split=this.ac.createChannelSplitter(2),this._merge=this.ac.createChannelMerger(2),this._leftGain=this.ac.createGain(),this._rightGain=this.ac.createGain(),this.leftDelay=this.ac.createDelay(),this.rightDelay=this.ac.createDelay(),this._leftFilter=new p5.Filter,this._rightFilter=new p5.Filter,this._leftFilter.disconnect(),this._rightFilter.disconnect(),this.lowPass=this._leftFilter,this._leftFilter.biquad.frequency.setValueAtTime(1200,this.ac.currentTime),this._rightFilter.biquad.frequency.setValueAtTime(1200,this.ac.currentTime),this._leftFilter.biquad.Q.setValueAtTime(.3,this.ac.currentTime),this._rightFilter.biquad.Q.setValueAtTime(.3,this.ac.currentTime),this.input.connect(this._split),this.leftDelay.connect(this._leftGain),this.rightDelay.connect(this._rightGain),this._leftGain.connect(this._leftFilter.input),this._rightGain.connect(this._rightFilter.input),this._merge.connect(this.output),this.output.connect(p5.soundOut.input),this._leftFilter.biquad.gain.setValueAtTime(1,this.ac.currentTime),this._rightFilter.biquad.gain.setValueAtTime(1,this.ac.currentTime),this.setType(0),this._maxDelay=this.leftDelay.delayTime.maxValue},p5.Delay.prototype.process=function(t,e,i,o){var n=i||0,s=e||0;if(n>=1)throw new Error("Feedback value will force a positive feedback loop.");if(s>=this._maxDelay)throw new Error("Delay Time exceeds maximum delay time of "+this._maxDelay+" second.");t.connect(this.input),this.leftDelay.delayTime.setValueAtTime(s,this.ac.currentTime),this.rightDelay.delayTime.setValueAtTime(s,this.ac.currentTime),this._leftGain.gain.setValueAtTime(n,this.ac.currentTime),this._rightGain.gain.setValueAtTime(n,this.ac.currentTime),o&&(this._leftFilter.freq(o),this._rightFilter.freq(o))},p5.Delay.prototype.delayTime=function(t){"number"!=typeof t?(t.connect(this.leftDelay.delayTime),t.connect(this.rightDelay.delayTime)):(this.leftDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.rightDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.leftDelay.delayTime.linearRampToValueAtTime(t,this.ac.currentTime),this.rightDelay.delayTime.linearRampToValueAtTime(t,this.ac.currentTime))},p5.Delay.prototype.feedback=function(t){if("number"!=typeof t)t.connect(this._leftGain.gain),t.connect(this._rightGain.gain);else{if(t>=1)throw new Error("Feedback value will force a positive feedback loop.");this._leftGain.gain.exponentialRampToValueAtTime(t,this.ac.currentTime),this._rightGain.gain.exponentialRampToValueAtTime(t,this.ac.currentTime)}},p5.Delay.prototype.filter=function(t,e){this._leftFilter.set(t,e),this._rightFilter.set(t,e)},p5.Delay.prototype.setType=function(t){switch(1===t&&(t="pingPong"),this._split.disconnect(),this._leftFilter.disconnect(),this._rightFilter.disconnect(),this._split.connect(this.leftDelay,0),this._split.connect(this.rightDelay,1),t){case"pingPong":this._rightFilter.setType(this._leftFilter.biquad.type),this._leftFilter.output.connect(this._merge,0,0),this._rightFilter.output.connect(this._merge,0,1),this._leftFilter.output.connect(this.rightDelay),this._rightFilter.output.connect(this.leftDelay);break;default:this._leftFilter.output.connect(this._merge,0,0),this._leftFilter.output.connect(this._merge,0,1),this._leftFilter.output.connect(this.leftDelay),this._leftFilter.output.connect(this.rightDelay)}},p5.Delay.prototype.amp=function(e,i,o){var i=i||0,o=o||0,n=t.audiocontext.currentTime,s=this.output.gain.value;this.output.gain.cancelScheduledValues(n),this.output.gain.linearRampToValueAtTime(s,n+o+.001),this.output.gain.linearRampToValueAtTime(e,n+o+i+.001)},p5.Delay.prototype.connect=function(t){var e=t||p5.soundOut.input;this.output.connect(e)},p5.Delay.prototype.disconnect=function(){this.output.disconnect()}}(master,filter);var reverb;reverb=function(){"use strict";var t=master;p5.Reverb=function(){this.ac=t.audiocontext,this.convolverNode=this.ac.createConvolver(),this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.input.gain.value=.5,this.input.connect(this.convolverNode),this.convolverNode.connect(this.output),this._seconds=3,this._decay=2,this._reverse=!1,this._buildImpulse(),this.connect(),t.soundArray.push(this)},p5.Reverb.prototype.process=function(t,e,i,o){t.connect(this.input);var n=!1;e&&(this._seconds=e,n=!0),i&&(this._decay=i),o&&(this._reverse=o),n&&this._buildImpulse()},p5.Reverb.prototype.set=function(t,e,i){var o=!1;t&&(this._seconds=t,o=!0),e&&(this._decay=e),i&&(this._reverse=i),o&&this._buildImpulse()},p5.Reverb.prototype.amp=function(e,i,o){var i=i||0,o=o||0,n=t.audiocontext.currentTime,s=this.output.gain.value;this.output.gain.cancelScheduledValues(n),this.output.gain.linearRampToValueAtTime(s,n+o+.001),this.output.gain.linearRampToValueAtTime(e,n+o+i+.001)},p5.Reverb.prototype.connect=function(t){var e=t||p5.soundOut.input;this.output.connect(e.input?e.input:e)},p5.Reverb.prototype.disconnect=function(){this.output.disconnect()},p5.Reverb.prototype._buildImpulse=function(){var t,e,i=this.ac.sampleRate,o=i*this._seconds,n=this._decay,s=this.ac.createBuffer(2,o,i),r=s.getChannelData(0),a=s.getChannelData(1);for(e=0;o>e;e++)t=this.reverse?o-e:e,r[e]=(2*Math.random()-1)*Math.pow(1-t/o,n),a[e]=(2*Math.random()-1)*Math.pow(1-t/o,n);this.convolverNode.buffer=s},p5.Reverb.prototype.dispose=function(){this.convolverNode.buffer=null,this.convolverNode=null,"undefined"!=typeof this.output&&(this.output.disconnect(),this.output=null),"undefined"!=typeof this.panner&&(this.panner.disconnect(),this.panner=null)},p5.Convolver=function(e,i){this.ac=t.audiocontext,this.convolverNode=this.ac.createConvolver(),this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.input.gain.value=.5,this.input.connect(this.convolverNode),this.convolverNode.connect(this.output),e?(this.impulses=[],this._loadBuffer(e,i)):(this._seconds=3,this._decay=2,this._reverse=!1,this._buildImpulse()),this.connect(),t.soundArray.push(this)},p5.Convolver.prototype=Object.create(p5.Reverb.prototype),p5.prototype.registerPreloadMethod("createConvolver"),p5.prototype.createConvolver=function(t,e){window.location.origin.indexOf("file://")>-1&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");var i=new p5.Convolver(t,e);return i.impulses=[],i},p5.Convolver.prototype._loadBuffer=function(t,e){t=p5.prototype._checkFileFormats(t);var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer";var o=this;i.onload=function(){var n=p5.prototype.getAudioContext();n.decodeAudioData(i.response,function(i){var n={},s=t.split("/");n.name=s[s.length-1],n.audioBuffer=i,o.impulses.push(n),o.convolverNode.buffer=n.audioBuffer,e&&e(n)})},i.send()},p5.Convolver.prototype.set=null,p5.Convolver.prototype.process=function(t){t.connect(this.input)},p5.Convolver.prototype.impulses=[],p5.Convolver.prototype.addImpulse=function(t,e){window.location.origin.indexOf("file://")>-1&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS"),this._loadBuffer(t,e)},p5.Convolver.prototype.resetImpulse=function(t,e){window.location.origin.indexOf("file://")>-1&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS"),this.impulses=[],this._loadBuffer(t,e)},p5.Convolver.prototype.toggleImpulse=function(t){if("number"==typeof t&&t<this.impulses.length&&(this.convolverNode.buffer=this.impulses[t].audioBuffer),"string"==typeof t)for(var e=0;e<this.impulses.length;e++)if(this.impulses[e].name===t){this.convolverNode.buffer=this.impulses[e].audioBuffer;break}},p5.Convolver.prototype.dispose=function(){for(var t in this.impulses)this.impulses[t]=null;this.convolverNode.disconnect(),this.concolverNode=null,"undefined"!=typeof this.output&&(this.output.disconnect(),this.output=null),"undefined"!=typeof this.panner&&(this.panner.disconnect(),this.panner=null)}}(master,sndcore);var looper;looper=function(){"use strict";function t(){m++,m>=f.length?(p=0,d.onended()):(p=0,f[m].start())}var e,i,o,n=master,s=10,r=0,a=.1,u=0,c=[],p=0,l=120,h=function(){};p5.prototype.setBPM=function(t){l=t},p5.Part=function(t,i){this.length=t||16,e=4*i||.5,this.noteResolution=0,this.isPlaying=!1,this.parts=[],this.onended=function(){this.stop()}},p5.Part.prototype.start=function(){p=0,this.isPlaying=!0,o=this,"score"!==i&&(r=n.audiocontext.currentTime),g()},p5.Part.prototype.loop=function(){this.onended=function(){p=0},this.start()},p5.Part.prototype.noLoop=function(){this.onended=function(){this.stop()}},p5.Part.prototype.stop=function(){this.isPlaying=!1,p=0},p5.Part.prototype.pause=function(){this.isPlaying=!1},p5.Part.prototype.addPhrase=function(t,e,i){this.parts.push({name:t,callback:e,array:i})},p5.Part.prototype.removePhrase=function(t){for(var e in this.parts)this.parts[e].name===t&&this.parts.split(e,1)},p5.Part.prototype.getPhrase=function(t){for(var e in this.parts)if(this.parts[e]===t)return this.parts[e]},p5.Part.prototype.onStep=function(t){h=t};var d,f,m,y=function(){var t=60/l;r+=e*t,p++,p>=o.length&&(p=0,o.onended())},v=function(t,e){if(c.push({note:t,time:e}),h(),o)for(var i=0;i<o.parts.length;i++)0!==o.parts[i].array[t]&&o.parts[i].callback(o.parts[i].array[t])},g=function(){if(o.isPlaying){for(;r<n.audiocontext.currentTime+a;)v(p,r),y();u=window.setTimeout(g,s)}};p5.Score=function(){f=[],m=0;for(var e in arguments)f[e]=arguments[e],f[e].nextPart=f[e+1],f[e].onended=function(){t()};this.looping=!1},p5.Score.prototype.onended=function(){this.looping?f[0].start():f[f.length-1].onended=function(){f[f.length-1].stop()},m=0},p5.Score.prototype.start=function(){i="score",d=this,f[m].start(),p=0},p5.Score.prototype.stop=function(){f[m].stop(),m=0,p=0},p5.Score.prototype.pause=function(){f[m].stop()},p5.Score.prototype.loop=function(){this.looping=!0,this.start()},p5.Score.prototype.noLoop=function(){this.looping=!1}}(master);var soundRecorder;soundRecorder=function(){"use strict";function t(t,e){for(var i=t.length+e.length,o=new Float32Array(i),n=0,s=0;i>s;)o[s++]=t[n],o[s++]=e[n],n++;return o}function e(t,e,i){for(var o=i.length,n=0;o>n;n++)t.setUint8(e+n,i.charCodeAt(n))}var i=master,o=i.audiocontext;p5.SoundRecorder=function(){this.input=o.createGain(),this.output=o.createGain(),this.recording=!1,this.bufferSize=1024,this._channels=2,this._clear(),this._jsNode=o.createScriptProcessor(this.bufferSize,this._channels,2),this._jsNode.onaudioprocess=this._audioprocess.bind(this),this._callback=function(){},this._jsNode.connect(p5.soundOut._silentNode),this.setInput()},p5.SoundRecorder.prototype.setInput=function(t){this.input.disconnect(),this.input=null,this.input=o.createGain(),this.input.connect(this._jsNode),this.input.connect(this.output),t?t.connect(this.input):p5.soundOut.output.connect(this.input)},p5.SoundRecorder.prototype.record=function(t,e,i){this.recording=!0,e&&(this.sampleLimit=Math.round(e*o.sampleRate)),t&&i?this._callback=function(){this.buffer=this._getBuffer(),console.log(this.buffer),t.setBuffer(this.buffer),i()}:t&&(this._callback=function(){this.buffer=this._getBuffer(),console.log(this.buffer),t.setBuffer(this.buffer)})},p5.SoundRecorder.prototype.stop=function(){this.recording=!1,this._callback(),this._clear()},p5.SoundRecorder.prototype._clear=function(){this._leftBuffers=[],this._rightBuffers=[],this.recordedSamples=0,this.sampleLimit=null},p5.SoundRecorder.prototype._audioprocess=function(t){if(this.recording!==!1&&this.recording===!0)if(this.sampleLimit&&this.recordedSamples>=this.sampleLimit)this.stop();else{var e=t.inputBuffer.getChannelData(0),i=t.inputBuffer.getChannelData(1);this._leftBuffers.push(new Float32Array(e)),this._rightBuffers.push(new Float32Array(i)),this.recordedSamples+=this.bufferSize}},p5.SoundRecorder.prototype._getBuffer=function(){var t=[];return t.push(this._mergeBuffers(this._leftBuffers)),t.push(this._mergeBuffers(this._rightBuffers)),t},p5.SoundRecorder.prototype._mergeBuffers=function(t){for(var e=new Float32Array(this.recordedSamples),i=0,o=t.length,n=0;o>n;n++){var s=t[n];e.set(s,i),i+=s.length}return e},p5.prototype.saveSound=function(i,o){var n=i.buffer.getChannelData(0),s=i.buffer.getChannelData(1),r=t(n,s),a=new ArrayBuffer(44+2*r.length),u=new DataView(a);e(u,0,"RIFF"),u.setUint32(4,44+2*r.length,!0),e(u,8,"WAVE"),e(u,12,"fmt "),u.setUint32(16,16,!0),u.setUint16(20,1,!0),u.setUint16(22,2,!0),u.setUint32(24,44100,!0),u.setUint32(28,176400,!0),u.setUint16(32,4,!0),u.setUint16(34,16,!0),e(u,36,"data"),u.setUint32(40,2*r.length,!0);for(var c=r.length,p=44,l=1,h=0;c>h;h++)u.setInt16(p,32767*r[h]*l,!0),p+=2;p5.prototype.writeFile([u],o,"wav")}}(sndcore,master);var src_app;src_app=function(){"use strict";var t=sndcore;return t}(sndcore,master,helpers,soundfile,amplitude,fft,signal,oscillator,env,pulse,noise,audioin,filter,delay,reverb,looper,soundRecorder);